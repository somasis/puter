#!/usr/bin/env bash
# shellcheck shell=bash

# shellcheck disable=SC2016
format='$artist - $title\n'

while getopts :f: arg >/dev/null 2>&1; do
    case "${arg}" in
        f)
            format="${OPTARG}"
            ;;
        *)
            usage
            ;;
    esac
done
shift $((OPTIND - 1))

# format=$(printf '%s' "${format}" | sed -E 's/%([a-z0-9_]+)%/\$\1/g)
format=${format//\\/\\\\}
while [ $# -gt 0 ]; do
    # shellcheck disable=SC2086
    if tags=$(envtag "${1}"); then
        printf '%s' "${tags:-:}" \
            | (eval "$(cat); echo -en ${format}")
    else
        exit 1
    fi
    shift
done
